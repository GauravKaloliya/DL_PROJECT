<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C.O.G.N.I.T. API Documentation</title>
  <style>
    :root {
      color-scheme: light;
      --bg: #f0f2f5;
      --panel: #ffffff;
      --text: #1c1e21;
      --muted: #65676b;
      --primary: #1877f2;
      --secondary: #e7f3ff;
      --accent: #d2e2ff;
      --warning: #ffb347;
      --success: #42b72a;
      --error: #c9444a;
      --border: #ccd0d5;
      --shadow: 0 8px 32px rgba(24, 119, 242, 0.15);
      --gradient: linear-gradient(135deg, #f0f2f5 0%, #e7f3ff 100%);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--gradient);
      color: var(--text);
      font-family: "Quicksand", "Nunito", system-ui, sans-serif;
      min-height: 100vh;
    }

    .app {
      max-width: 1024px;
      margin: 0 auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .panel {
      background: var(--panel);
      border: 2px solid var(--border);
      border-radius: 24px;
      padding: 28px;
      box-shadow: var(--shadow);
    }

    .primary {
      padding: 14px 28px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      font-family: inherit;
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 15px rgba(24, 119, 242, 0.4);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ghost {
      padding: 14px 28px;
      border-radius: 50px;
      border: 2px solid var(--border);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      font-family: inherit;
      background: transparent;
      color: var(--text);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
    }

    .section-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
      border-bottom: 2px solid var(--border);
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      color: var(--muted);
      font-weight: 600;
      cursor: pointer;
      text-transform: capitalize;
      border-radius: 8px 8px 0 0;
    }

    .tab-button.active {
      background: rgba(24, 119, 242, 0.1);
      border-bottom-color: var(--primary);
      color: var(--primary);
    }

    .endpoint-card {
      border: 2px solid var(--border);
      border-radius: 12px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .endpoint-header {
      padding: 16px 20px;
      background: var(--bg);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .endpoint-body {
      padding: 20px;
    }

    .endpoint-body.hidden {
      display: none;
    }

    .endpoint-method {
      color: white;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
    }

    .code-block {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 16px;
      border-radius: 8px;
      overflow: auto;
      font-family: Consolas, Monaco, "Courier New", monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    .code-block.small {
      padding: 12px;
      font-size: 12px;
    }

    .loading {
      text-align: center;
      padding: 40px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 14px;
    }

    th,
    td {
      padding: 12px;
      text-align: left;
    }

    thead tr {
      background: var(--primary);
      color: white;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
    }

    footer {
      margin-top: 48px;
      padding-top: 24px;
      border-top: 2px solid var(--border);
      text-align: center;
      color: var(--muted);
    }

    @media (max-width: 640px) {
      .panel {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="panel">
      <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 32px; flex-wrap: wrap; gap: 16px;">
        <div>
          <h1 style="margin: 0; color: var(--primary);">C.O.G.N.I.T. API Reference</h1>
          <p style="color: var(--muted); margin: 8px 0 0;" id="api-version">Version {{ version }}</p>
        </div>
        <div style="display: flex; gap: 12px;">
          <a class="ghost" href="/api/docs" target="_blank" rel="noopener">View JSON</a>
        </div>
      </div>

      <div class="section-tabs">
        <button class="tab-button active" data-section="overview">overview</button>
        <button class="tab-button" data-section="endpoints">endpoints</button>
        <button class="tab-button" data-section="examples">examples</button>
        <button class="tab-button" data-section="errors">errors</button>
      </div>

      <div id="docs-content" class="loading">
        <h2>Loading API Documentation...</h2>
      </div>

      <footer>
        <p>C.O.G.N.I.T. API Documentation • Created by Gaurav Kaloliya</p>
      </footer>
    </div>
  </div>

  <script>
    const methodColors = {
      GET: '#42b72a',
      POST: '#1877f2',
      PUT: '#ffb347',
      DELETE: '#c9444a',
      PATCH: '#9966ff'
    };

    const defaultDocs = {
      description: 'The C.O.G.N.I.T. (Cognitive Network for Image & Text Modeling) API provides programmatic access to the research platform. This RESTful API allows you to integrate image description tasks into your applications and manage submissions.',
      version: '{{ version }}',
      base_url: '{{ base_url }}',
      security: {
        rate_limiting: '200 per day, 50 per hour (default)',
        authentication: 'None required for participant endpoints',
        data_protection: 'IP hashing, privacy-preserving storage'
      }
    };

    const docsContent = document.getElementById('docs-content');
    const versionEl = document.getElementById('api-version');

    function createCodeBlock(content, small = false) {
      const wrapper = document.createElement('div');
      wrapper.className = `code-block${small ? ' small' : ''}`;
      const pre = document.createElement('pre');
      pre.style.margin = '0';
      pre.textContent = content;
      wrapper.appendChild(pre);
      return wrapper;
    }

    function createEndpointCard(endpoint) {
      const card = document.createElement('div');
      card.className = 'endpoint-card';

      const header = document.createElement('div');
      header.className = 'endpoint-header';

      const method = document.createElement('span');
      method.className = 'endpoint-method';
      method.style.background = methodColors[endpoint.method] || '#666';
      method.textContent = endpoint.method;

      const path = document.createElement('code');
      path.style.fontSize = '14px';
      path.style.color = 'var(--text)';
      path.textContent = endpoint.path;

      const chevron = document.createElement('span');
      chevron.style.marginLeft = 'auto';
      chevron.style.fontSize = '20px';
      chevron.textContent = '▶';

      header.appendChild(method);
      header.appendChild(path);
      header.appendChild(chevron);

      const body = document.createElement('div');
      body.className = 'endpoint-body hidden';

      const desc = document.createElement('p');
      desc.style.color = 'var(--muted)';
      desc.style.marginBottom = '16px';
      desc.textContent = endpoint.description || '';
      body.appendChild(desc);

      if (endpoint.rate_limit) {
        const rate = document.createElement('div');
        rate.style.marginBottom = '12px';
        rate.innerHTML = `<span style="font-size: 12px; color: var(--muted)"><strong>Rate Limit:</strong> ${endpoint.rate_limit}</span>`;
        body.appendChild(rate);
      }

      if (endpoint.auth_required !== undefined) {
        const auth = document.createElement('div');
        auth.style.marginBottom = '12px';
        auth.innerHTML = `<span style="font-size: 12px; color: ${endpoint.auth_required ? '#f59e0b' : '#42b72a'}"><strong>Auth Required:</strong> ${endpoint.auth_required ? 'Yes' : 'No'}</span>`;
        body.appendChild(auth);
      }

      if (endpoint.query_params || endpoint.parameters) {
        const params = endpoint.parameters || Object.entries(endpoint.query_params || {}).map(([key, value]) => ({
          name: key,
          type: 'string',
          required: false,
          description: value
        }));

        if (params.length) {
          const section = document.createElement('div');
          section.style.marginBottom = '16px';
          const heading = document.createElement('h4');
          heading.textContent = 'Parameters';
          heading.style.marginBottom = '8px';
          section.appendChild(heading);

          const table = document.createElement('table');
          table.innerHTML = `
            <thead>
              <tr style="text-align: left; border-bottom: 1px solid var(--border)">
                <th style="padding: 8px">Name</th>
                <th style="padding: 8px">Type</th>
                <th style="padding: 8px">Required</th>
                <th style="padding: 8px">Description</th>
              </tr>
            </thead>
            <tbody>
              ${params.map((param) => `
                <tr style="border-bottom: 1px solid var(--border)">
                  <td style="padding: 8px"><code>${param.name}</code></td>
                  <td style="padding: 8px">${param.type || 'string'}</td>
                  <td style="padding: 8px">${param.required ? 'Yes' : 'No'}</td>
                  <td style="padding: 8px">${param.description || ''}</td>
                </tr>
              `).join('')}
            </tbody>
          `;
          section.appendChild(table);
          body.appendChild(section);
        }
      }

      if (endpoint.validation) {
        const section = document.createElement('div');
        section.style.marginBottom = '16px';
        const heading = document.createElement('h4');
        heading.textContent = 'Validation Rules';
        heading.style.marginBottom = '8px';
        section.appendChild(heading);
        section.appendChild(createCodeBlock(JSON.stringify(endpoint.validation, null, 2), true));
        body.appendChild(section);
      }

      if (endpoint.request_body) {
        const section = document.createElement('div');
        section.style.marginBottom = '16px';
        const heading = document.createElement('h4');
        heading.textContent = 'Request Body';
        heading.style.marginBottom = '8px';
        section.appendChild(heading);
        section.appendChild(createCodeBlock(JSON.stringify(endpoint.request_body, null, 2), true));
        body.appendChild(section);
      }

      if (endpoint.response) {
        const section = document.createElement('div');
        const heading = document.createElement('h4');
        heading.textContent = 'Response';
        heading.style.marginBottom = '8px';
        section.appendChild(heading);
        section.appendChild(createCodeBlock(typeof endpoint.response === 'string' ? endpoint.response : JSON.stringify(endpoint.response, null, 2), true));
        body.appendChild(section);
      }

      header.addEventListener('click', () => {
        const isHidden = body.classList.toggle('hidden');
        chevron.textContent = isHidden ? '▶' : '▼';
      });

      card.appendChild(header);
      card.appendChild(body);
      return card;
    }

    function renderOverview(docs) {
      const section = document.createElement('div');

      section.innerHTML = `
        <h2 style="color: var(--primary)">Overview</h2>
        <p style="font-size: 16px; line-height: 1.6;">${docs.description || defaultDocs.description}</p>
        <h3 style="margin-top: 32px;">Version</h3>
        <div style="background: var(--bg); padding: 12px 16px; border-radius: 8px; border: 2px solid var(--border); font-family: monospace; font-size: 14px; display: inline-block;">${docs.version || defaultDocs.version}</div>
        <h3 style="margin-top: 32px;">Base URL</h3>
        <div style="background: var(--bg); padding: 16px; border-radius: 12px; border: 2px solid var(--border); font-family: monospace; font-size: 14px;">${docs.base_url || defaultDocs.base_url}</div>
      `;

      if (docs.security) {
        const security = document.createElement('div');
        security.innerHTML = `
          <h3 style="margin-top: 32px;">Security</h3>
          <ul style="line-height: 1.8;">
            <li><strong>Rate Limiting:</strong> ${docs.security.rate_limiting}</li>
            <li><strong>Authentication:</strong> ${docs.security.authentication}</li>
            <li><strong>Data Protection:</strong> ${docs.security.data_protection}</li>
          </ul>
        `;
        section.appendChild(security);
      }

      const features = document.createElement('div');
      features.innerHTML = `
        <h3 style="margin-top: 32px;">Features</h3>
        <ul style="line-height: 1.8;">
          <li><strong>Image Management:</strong> Fetch random images from a unified survey library with normal, survey, and attention categories</li>
          <li><strong>Data Submission:</strong> Submit participant responses with descriptions, ratings, and feedback</li>
          <li><strong>Health Monitoring:</strong> Check system connectivity and service status</li>
          <li><strong>Security:</strong> Rate limiting and hardened security headers</li>
        </ul>
        <h3 style="margin-top: 32px;">Quick Start</h3>
        <ol style="line-height: 1.8;">
          <li>Make your first request to <code>/api/images/random</code></li>
          <li>Submit participant data via <code>/api/submit</code></li>
          <li>Retrieve submissions via <code>/api/submissions/&lt;participant_id&gt;</code></li>
        </ol>
      `;
      section.appendChild(features);
      return section;
    }

    function renderEndpoints(docs) {
      const section = document.createElement('div');
      const title = document.createElement('h2');
      title.style.color = 'var(--primary)';
      title.textContent = 'API Endpoints';
      section.appendChild(title);

      if (docs.endpoints) {
        const heading = document.createElement('h3');
        heading.style.marginTop = '24px';
        heading.textContent = 'Available Endpoints';
        section.appendChild(heading);

        Object.values(docs.endpoints).forEach((endpoint) => {
          section.appendChild(createEndpointCard(endpoint));
        });
      }

      return section;
    }

    function renderExamples() {
      const section = document.createElement('div');
      section.innerHTML = `
        <h2 style="color: var(--primary)">Code Examples</h2>
        <h3 style="margin-top: 24px;">JavaScript / Fetch</h3>
      `;

      section.appendChild(createCodeBlock(`// Check system health\nconst healthResponse = await fetch('/api/health');\nconst health = await healthResponse.json();\nconsole.log(health.status); // 'healthy' or 'degraded'\n\n// Get a random image\nconst response = await fetch('/api/images/random?type=normal');\nconst image = await response.json();\nconsole.log(image.image_url);\n\n// Submit participant data\nconst submission = {\n  participant_id: 'user-123',\n  session_id: 'session-456',\n  image_id: 'survey/aurora-lake.svg',\n  description: 'The image shows a beautiful sunset over mountains...',\n  rating: 8,\n  feedback: 'Interesting image',\n  time_spent_seconds: 45,\n  is_survey: false,\n  is_attention: false\n};\n\nconst submitResponse = await fetch('/api/submit', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify(submission)\n});\n\nconst result = await submitResponse.json();\nconsole.log(result.status); // 'ok'`));

      const pythonTitle = document.createElement('h3');
      pythonTitle.style.marginTop = '32px';
      pythonTitle.textContent = 'Python / Requests';
      section.appendChild(pythonTitle);
      section.appendChild(createCodeBlock(`import requests\n\n# Check system health\nhealth_response = requests.get('http://localhost:5000/api/health')\nhealth = health_response.json()\nprint(health['status'])  # 'healthy' or 'degraded'\n\n# Get a random image\nresponse = requests.get('http://localhost:5000/api/images/random?type=normal')\nimage = response.json()\nprint(image['image_url'])\n\n# Submit participant data\nsubmission = {\n    'participant_id': 'user-123',\n    'session_id': 'session-456',\n    'image_id': 'survey/aurora-lake.svg',\n    'description': 'The image shows a beautiful sunset...',\n    'rating': 8,\n    'feedback': 'Interesting image',\n    'time_spent_seconds': 45,\n    'is_survey': False,\n    'is_attention': False\n}\n\nresponse = requests.post(\n    'http://localhost:5000/api/submit',\n    json=submission\n)\nresult = response.json()\nprint(result['status'])  # 'ok'`));

      const curlTitle = document.createElement('h3');
      curlTitle.style.marginTop = '32px';
      curlTitle.textContent = 'cURL';
      section.appendChild(curlTitle);
      section.appendChild(createCodeBlock(`# Check system health\ncurl -X GET "http://localhost:5000/api/health"\n\n# Get a random image\ncurl -X GET "http://localhost:5000/api/images/random?type=normal"\n\n# Submit participant data\ncurl -X POST "http://localhost:5000/api/submit" \\\n  -H "Content-Type: application/json" \\\n  -d '{\n    "participant_id": "user-123",\n    "session_id": "session-456",\n    "image_id": "survey/aurora-lake.svg",\n    "description": "The image shows...",\n    "rating": 8,\n    "feedback": "Great image",\n    "time_spent_seconds": 45,\n    "is_survey": false,\n    "is_attention": false\n  }'`));

      return section;
    }

    function renderErrors(docs) {
      const section = document.createElement('div');
      section.innerHTML = `
        <h2 style="color: var(--primary)">Error Handling</h2>
        <p>The API uses standard HTTP response codes to indicate the success or failure of requests.</p>
        <h3 style="margin-top: 24px;">HTTP Status Codes</h3>
      `;

      const table = document.createElement('table');
      const errors = docs.error_handling?.common_errors || {
        200: 'Request succeeded',
        400: 'Invalid parameters or missing required fields',
        401: 'Authentication required',
        404: 'Resource not found',
        415: 'Request must use application/json',
        429: 'Rate limit exceeded',
        500: 'Server-side error'
      };

      const rows = Object.entries(errors).map(([code, description]) => {
        const meaning = {
          200: 'OK',
          400: 'Bad Request',
          401: 'Unauthorized',
          403: 'Forbidden',
          404: 'Not Found',
          409: 'Conflict',
          415: 'Unsupported Media Type',
          429: 'Too Many Requests',
          500: 'Internal Server Error'
        }[code] || '';

        return `
          <tr>
            <td><code>${code}</code></td>
            <td>${meaning}</td>
            <td>${description}</td>
          </tr>
        `;
      }).join('');

      table.innerHTML = `
        <thead>
          <tr>
            <th>Code</th>
            <th>Meaning</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      `;
      section.appendChild(table);

      const errorFormat = docs.error_handling?.error_format || { error: 'Description of what went wrong' };
      const formatHeading = document.createElement('h3');
      formatHeading.style.marginTop = '32px';
      formatHeading.textContent = 'Error Response Format';
      section.appendChild(formatHeading);
      section.appendChild(createCodeBlock(JSON.stringify(errorFormat, null, 2)));

      const list = document.createElement('div');
      list.innerHTML = `
        <h3 style="margin-top: 32px;">Common Errors</h3>
        <ul style="line-height: 1.8;">
          <li><code>Minimum 60 words required</code> - Description is too short</li>
          <li><code>rating must be an integer between 1-10</code> - Invalid rating value</li>
          <li><code>comments must be at least 5 characters</code> - Feedback is too short</li>
          <li><code>image_id is required</code> - Missing required field</li>
        </ul>
      `;
      section.appendChild(list);

      return section;
    }

    function setActiveSection(sectionId, docs) {
      docsContent.innerHTML = '';
      let content;
      if (sectionId === 'overview') {
        content = renderOverview(docs);
      } else if (sectionId === 'endpoints') {
        content = renderEndpoints(docs);
      } else if (sectionId === 'examples') {
        content = renderExamples();
      } else if (sectionId === 'errors') {
        content = renderErrors(docs);
      }

      if (content) {
        docsContent.appendChild(content);
      }
    }

    function initTabs(docs) {
      const buttons = document.querySelectorAll('.tab-button');
      buttons.forEach((button) => {
        button.addEventListener('click', () => {
          buttons.forEach((btn) => btn.classList.remove('active'));
          button.classList.add('active');
          setActiveSection(button.dataset.section, docs);
        });
      });

      setActiveSection('overview', docs);
    }

    fetch('/api/docs')
      .then((response) => response.json())
      .then((docs) => {
        const mergedDocs = { ...defaultDocs, ...docs };
        versionEl.textContent = `Version ${mergedDocs.version}`;
        initTabs(mergedDocs);
      })
      .catch(() => {
        initTabs(defaultDocs);
      });
  </script>
</body>
</html>
